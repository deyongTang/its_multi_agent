# ITS å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ â€” å…¨é“¾è·¯æµ‹è¯•ç”¨ä¾‹

> ç‰ˆæœ¬: v1.0 | æ—¥æœŸ: 2026-02-25

---

## æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›® | è¯´æ˜ |
|------|------|
| åç«¯åœ°å€ | `http://127.0.0.1:8000` |
| æ¥å£ | `POST /api/chat` (SSE æµå¼) |
| å‰ææ¡ä»¶ | MCP æœåŠ¡å·²å¯åŠ¨ï¼ŒçŸ¥è¯†åº“æœåŠ¡å·²å¯åŠ¨ï¼ˆ`:8001`ï¼‰ï¼ŒMySQL å·²è¿æ¥ |

---

## TC-01 é—²èŠåœºæ™¯

**ç›®çš„**: éªŒè¯æ„å›¾è¯†åˆ«æ­£ç¡®è·¯ç”±åˆ° `general_chat`ï¼Œä¸è§¦å‘æ£€ç´¢æµç¨‹ã€‚

**è¾“å…¥**
```
ä½ å¥½ï¼Œä»Šå¤©å¤©æ°”çœŸä¸é”™
```

**é¢„æœŸæµç¨‹**
```
intent â†’ route_intent(chitchat) â†’ general_chat â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­å‡ºç° `è¿›å…¥ç¯èŠ‚: general_chat`
- è¿”å›å‹å¥½çš„é—²èŠå›å¤ï¼Œå†…å®¹å¼•å¯¼ç”¨æˆ·å›åˆ°ä¸šåŠ¡é—®é¢˜
- ä¸å‡ºç° `è¿›å…¥ç¯èŠ‚: slot_filling`
- ä¸å‡ºç° `è¿›å…¥ç¯èŠ‚: retrieval`

---

## TC-02 æŠ€æœ¯é—®é¢˜ â€” æ§½ä½ä¸å®Œæ•´ï¼Œè§¦å‘è¿½é—®

**ç›®çš„**: éªŒè¯æ§½ä½ç¼ºå¤±æ—¶èµ° `ask_user` åˆ†æ”¯ï¼Œä¸è¿›å…¥æ£€ç´¢ã€‚

**è¾“å…¥**
```
ç”µè„‘è“å±äº†
```

**é¢„æœŸæµç¨‹**
```
intent â†’ route_intent(tech_issue) â†’ slot_filling â†’ route_slot_check(ç¼ºå¤±æ§½ä½) â†’ ask_user â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­å‡ºç° `è¿›å…¥ç¯èŠ‚: ask_user`
- è¿”å›è¿½é—®è¯æœ¯ï¼Œä¾‹å¦‚"è¯·é—®æ˜¯å“ªæ¬¾å‹å·ï¼Ÿå‡ºç°äº†ä»€ä¹ˆé”™è¯¯ä»£ç ï¼Ÿ"
- `ask_user_count` ä» 0 å˜ä¸º 1
- ä¸å‡ºç° `è¿›å…¥ç¯èŠ‚: retrieval`

---

## TC-03 æŠ€æœ¯é—®é¢˜ â€” çŸ¥è¯†åº“å‘½ä¸­ï¼Œå…¨é“¾è·¯æ­£å¸¸

**ç›®çš„**: éªŒè¯æŠ€æœ¯é—®é¢˜å®Œæ•´èµ°å®Œæ£€ç´¢å­å›¾ï¼ŒçŸ¥è¯†åº“è¿”å›ç­”æ¡ˆåç›´æ¥é€ä¼ ã€‚

**è¾“å…¥**
```
æˆ‘çš„ ThinkPad X1 Carbon å‡çº§ç³»ç»Ÿåè“å±ï¼Œé”™è¯¯ä»£ç  0x0000007E
```

**é¢„æœŸæµç¨‹**
```
intent â†’ slot_filling(æ§½ä½é½å…¨) â†’ retrievalå­å›¾:
  dispatch(source=kb) â†’ search(KB) â†’ evaluate(sufficient=true) â†’ exit
â†’ verify(pass) â†’ generate_report â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­ä¾æ¬¡å‡ºç°ï¼š`slot_filling` â†’ `retrieval` â†’ `verify` â†’ `generate_report`
- `generate_report` èŠ‚ç‚¹ç›´æ¥é€ä¼  KB ç­”æ¡ˆï¼Œä¸äºŒæ¬¡è°ƒç”¨ LLM åˆæˆ
- æœ€ç»ˆå›å¤åŒ…å«å…·ä½“çš„è“å±æ’æŸ¥æ­¥éª¤
- `final_report.doc_count >= 1`

---

## TC-04 æŠ€æœ¯é—®é¢˜ â€” çŸ¥è¯†åº“æœªå‘½ä¸­ï¼Œè‡ªåŠ¨æ¢æº Web

**ç›®çš„**: éªŒè¯ KB æ— ç»“æœæ—¶ï¼Œæ£€ç´¢å­å›¾è‡ªåŠ¨åˆ‡æ¢åˆ° Web æœç´¢å…œåº•ã€‚

**è¾“å…¥**
```
è”æƒ³ Legion 7i 2025æ¬¾ æ•£çƒ­é£æ‰‡å¼‚å“æ€ä¹ˆå¤„ç†
```

**é¢„æœŸæµç¨‹**
```
retrievalå­å›¾:
  dispatch(source=kb) â†’ search(KB, æ— ç»“æœ) â†’ evaluate(sufficient=false, suggestion=switch_source)
  â†’ rewrite(source: kbâ†’web) â†’ search(Web) â†’ evaluate(sufficient=true) â†’ exit
```

**é¢„æœŸç»“æœ**
- SSE ä¸­ `retrieval` èŠ‚ç‚¹å†…éƒ¨å¾ªç¯æ‰§è¡Œ 2 æ¬¡ search
- æœ€ç»ˆæ–‡æ¡£æ¥æºä¸º `WebSearch`
- æœ€ç»ˆå›å¤åŒ…å«æ¥è‡ªç½‘ç»œçš„ç›¸å…³ä¿¡æ¯
- `loop_count = 2`ï¼ˆå¾ªç¯ä¸€æ¬¡åé€€å‡ºï¼‰

---

## TC-05 æŠ€æœ¯é—®é¢˜ â€” æ£€ç´¢è´¨é‡ä¸åˆæ ¼ï¼Œå‡çº§äººå·¥

**ç›®çš„**: éªŒè¯ verify èŠ‚ç‚¹è´¨é‡æŠŠå…³ï¼Œæ£€ç´¢ç»“æœä¸ç›¸å…³æ—¶èµ° escalateã€‚

**è¾“å…¥**
```
xyzabc123 å‹å·ä¸»æ¿çƒ§äº†æ€ä¹ˆä¿®
```

**é¢„æœŸæµç¨‹**
```
retrievalå­å›¾: æ£€ç´¢åˆ°æ— å…³å†…å®¹ â†’ exit
â†’ verify(pass=false, æ¸…ç©ºæ–‡æ¡£) â†’ route_verify_result(æ— æ–‡æ¡£) â†’ escalate â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­å‡ºç° `è¿›å…¥ç¯èŠ‚: escalate`
- æœ€ç»ˆå›å¤åŒ…å«"è½¬æ¥äººå·¥å®¢æœ"ç›¸å…³è¯æœ¯
- `need_human_help = true`
- ä¸å‡ºç° `è¿›å…¥ç¯èŠ‚: generate_report`

---

## TC-06 æœåŠ¡ç«™æŸ¥è¯¢

**ç›®çš„**: éªŒè¯æœåŠ¡ç«™æ„å›¾èµ°æœ¬åœ°å·¥å…·ï¼ˆMySQL + åæ ‡è§£æï¼‰ã€‚

**è¾“å…¥**
```
åŒ—äº¬æœé˜³åŒºé™„è¿‘æœ‰è”æƒ³æœåŠ¡ç«™å—
```

**é¢„æœŸæµç¨‹**
```
intent(service_station) â†’ slot_filling(location=åŒ—äº¬æœé˜³åŒº) â†’ retrievalå­å›¾:
  dispatch(source=local_tools) â†’ search(MySQL) â†’ evaluate(sufficient=true) â†’ exit
â†’ verify â†’ generate_report â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­å‡ºç° `è¿›å…¥ç¯èŠ‚: retrieval`
- æœ€ç»ˆå›å¤åŒ…å«æœåŠ¡ç«™åç§°ã€åœ°å€ã€ç”µè¯ã€è·ç¦»
- æ–‡æ¡£æ¥æºä¸º `LocalDB`
- ä¸è°ƒç”¨çŸ¥è¯†åº“æˆ– Web æœç´¢

---

## TC-07 POI å¯¼èˆªæŸ¥è¯¢

**ç›®çš„**: éªŒè¯å¯¼èˆªæ„å›¾è°ƒç”¨ç™¾åº¦åœ°å›¾ MCP å·¥å…·ã€‚

**è¾“å…¥**
```
å¸®æˆ‘å¯¼èˆªåˆ°è”æƒ³åŒ—äº¬æ€»éƒ¨
```

**é¢„æœŸæµç¨‹**
```
intent(poi_navigation) â†’ slot_filling(destination=è”æƒ³åŒ—äº¬æ€»éƒ¨) â†’ retrievalå­å›¾:
  dispatch(source=local_tools) â†’ search(BaiduMap MCP) â†’ evaluate â†’ exit
â†’ verify â†’ generate_report â†’ END
```

**é¢„æœŸç»“æœ**
- SSE ä¸­å‡ºç° `ğŸ”§ è°ƒç”¨å·¥å…·: map_poi_search`
- æœ€ç»ˆå›å¤åŒ…å«åœ°ç‚¹åç§°å’Œåœ°å€ä¿¡æ¯
- æ–‡æ¡£æ¥æºä¸º `BaiduMap`

---

## TC-08 å¤šè½®è¿½é—®åå®Œæˆæ£€ç´¢

**ç›®çš„**: éªŒè¯è¿½é—®è¡¥å…¨æ§½ä½åï¼Œç¬¬äºŒè½®æ¶ˆæ¯èƒ½æ­£å¸¸è¿›å…¥æ£€ç´¢æµç¨‹ã€‚

**ç¬¬ä¸€è½®è¾“å…¥**
```
ç”µè„‘å¼€ä¸äº†æœº
```

**é¢„æœŸ**: è§¦å‘è¿½é—®ï¼Œè¿”å›"è¯·é—®æ˜¯å“ªæ¬¾å‹å·ï¼Ÿ"

**ç¬¬äºŒè½®è¾“å…¥**ï¼ˆåŒä¸€ sessionï¼‰
```
ThinkPad E14ï¼ŒæŒ‰ç”µæºé”®æ²¡ååº”
```

**é¢„æœŸæµç¨‹**ï¼ˆç¬¬äºŒè½®ï¼‰
```
intent(tech_issue) â†’ slot_filling(æ§½ä½è¡¥å…¨) â†’ route_slot_check(æ§½ä½é½å…¨) â†’ retrieval â†’ verify â†’ generate_report
```

**é¢„æœŸç»“æœ**
- ç¬¬äºŒè½®ä¸å†è¿½é—®
- æ­£å¸¸è¿›å…¥æ£€ç´¢å¹¶è¿”å›ç­”æ¡ˆ
- `ask_user_count` ä¿æŒä¸º 1ï¼ˆä¸é‡ç½®ï¼‰

---

## TC-09 æµå¼è¾“å‡ºè¿‡æ»¤éªŒè¯

**ç›®çš„**: éªŒè¯åªæœ‰ `generate_report` / `general_chat` / `ask_user` èŠ‚ç‚¹çš„ token ä½œä¸º ANSWER é€ä¼ ï¼Œä¸­é—´èŠ‚ç‚¹ï¼ˆintent/slot_filling/evaluate/verifyï¼‰çš„ LLM è¾“å‡ºä¸æ³„æ¼åˆ°å‰ç«¯ã€‚

**è¾“å…¥**
```
ThinkPad X1 è“å±ï¼Œé”™è¯¯ä»£ç  0x00000050
```

**éªŒè¯æ–¹å¼**: æŠ“å–å®Œæ•´ SSE äº‹ä»¶æµï¼Œé€æ¡æ£€æŸ¥ `kind` å­—æ®µã€‚

**é¢„æœŸç»“æœ**
- `ContentKind.ANSWER` ç±»å‹çš„ SSE åŒ…ï¼Œä»…åœ¨ `generate_report` èŠ‚ç‚¹æ‰§è¡ŒæœŸé—´å‡ºç°
- `intent` / `slot_filling` / `evaluate` / `verify` èŠ‚ç‚¹æ‰§è¡ŒæœŸé—´ï¼Œä¸å‡ºç° `ContentKind.ANSWER` åŒ…
- `ContentKind.PROCESS` åŒ…æ­£å¸¸å‡ºç°ï¼ˆèŠ‚ç‚¹è¿›å…¥æç¤ºï¼‰
- `ContentKind.THINKING` åŒ…ï¼ˆå¦‚æœ‰æ¨ç†æ¨¡å‹ï¼‰ä»…åœ¨ç­”æ¡ˆèŠ‚ç‚¹å‡ºç°

---

## TC-10 è¶…æ—¶ä¿æŠ¤éªŒè¯

**ç›®çš„**: éªŒè¯ LLM è°ƒç”¨è¶…æ—¶æ—¶ç³»ç»Ÿä¸å¡æ­»ï¼Œè¿”å›å…œåº•æ¶ˆæ¯ã€‚

**æ¨¡æ‹Ÿæ–¹å¼**: ä¸´æ—¶å°† `_llm_evaluate` / `_llm_verify` çš„ `timeout_s` æ”¹ä¸º 0.001sï¼Œæˆ– mock LLM å»¶è¿Ÿ 30sã€‚

**é¢„æœŸç»“æœ**
- è¶…æ—¶åè§¦å‘é‡è¯•ï¼ˆæœ€å¤š 2 æ¬¡ï¼‰
- é‡è¯•å…¨éƒ¨å¤±è´¥åï¼ŒèŠ‚ç‚¹è¿”å›å®‰å…¨é»˜è®¤å€¼ï¼ˆ`sufficient=true` / `pass=true`ï¼‰ï¼Œæµç¨‹ç»§ç»­
- ä¸å‡ºç°æœªæ•è·å¼‚å¸¸
- æ—¥å¿—ä¸­å‡ºç° `[Retry] ... è¶…æ—¶` è®°å½•

---

## é€šè¿‡æ ‡å‡†æ±‡æ€»

| ç”¨ä¾‹ | å…³é”®æ–­è¨€ |
|------|---------|
| TC-01 | æ„å›¾=chitchatï¼Œæ— æ£€ç´¢èŠ‚ç‚¹ |
| TC-02 | ask_user_count>0ï¼Œæ— æ£€ç´¢èŠ‚ç‚¹ |
| TC-03 | KB å‘½ä¸­ï¼Œgenerate_report ç›´é€ä¼  |
| TC-04 | loop_count=2ï¼Œæ–‡æ¡£æ¥æº=WebSearch |
| TC-05 | need_human_help=trueï¼Œæ—  generate_report |
| TC-06 | æ–‡æ¡£æ¥æº=LocalDBï¼ŒåŒ…å«æœåŠ¡ç«™ä¿¡æ¯ |
| TC-07 | è°ƒç”¨ map_poi_search å·¥å…· |
| TC-08 | ç¬¬äºŒè½®ä¸è¿½é—®ï¼Œæ­£å¸¸å‡ºç­”æ¡ˆ |
| TC-09 | ANSWER åŒ…ä»…æ¥è‡ªç­”æ¡ˆèŠ‚ç‚¹ |
| TC-10 | è¶…æ—¶ä¸å´©æºƒï¼Œæœ‰å…œåº•æ¶ˆæ¯ |
