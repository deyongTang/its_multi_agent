# 核心设计原则：AI 系统构建哲学
## (The Philosophy of AI System Architecture)

> **"大模型只做最关键的思考部分，机械繁杂的事情交由算法去做。"**

这是我们在构建 ITS 多智能体及 RAG 系统时总结出的最高指导原则。无论是现在的检索优化，还是未来的 Agent 规划，我们都必须严格遵循这一思想。

---

## 1. 核心理念 (Core Concept)

### 1.1 拒绝"大模型万能论"
不要试图把所有任务都扔给 LLM。虽然 LLM 很强，但它存在 **"慢、贵、幻觉、不可控"** 的原生缺陷。

### 1.2 黄金分工法则 (The Golden Division of Labor)

*   **算法/代码 (Algorithms/Code)** —— **负责"腿"的工作**
    *   **特性**：确定性、极速、零成本、处理海量数据。
    *   **职责**：
        *   **检索 (Retrieval)**：利用 TF-IDF/BM25/向量索引，从百万级文档中捞出 Top 50。
        *   **初筛 (Filtering)**：利用 RRF、硬规则、正则匹配过滤明显噪音。
        *   **记忆 (Memory)**：利用数据库、Redis 存储结构化状态。
        *   **工具执行 (Execution)**：API 调用、文件读写、数据库操作。

*   **大模型 (LLM)** —— **负责"脑"的工作**
    *   **特性**：概率性、慢速、高成本、强推理能力。
    *   **职责**：
        *   **意图理解 (Understanding)**：用户到底想干什么？(Query Rewriting)
        *   **精选 (Selection)**：在算法选出的 Top 5 里，哪一个才是真正的答案？(Reranking/Reasoning)
        *   **生成 (Generation)**：基于事实，用人话组织答案。
        *   **规划 (Planning)**：面对复杂任务，第一步做什么，第二步做什么？(CoT)

---

## 2. RAG 系统中的落地 (RAG Implementation)

| 环节 | 谁来做？ | 为什么？ |
| :--- | :--- | :--- |
| **召回 (Recall)** | **算法 (ES/Vector)** | 需要遍历海量文档，LLM 读不过来，且不需要推理。 |
| **粗排 (Ranking)** | **算法 (RRF)** | 数学统计足够有效，无需语义理解。 |
| **精排 (Rerank)** | **小模型 (Cross-Encoder)** | 需要轻度语义理解，但大模型太慢太贵。 |
| **阅读 (Reading)** | **大模型 (LLM)** | 需要深度理解上下文，提取关键信息。 |
| **回答 (Answering)** | **大模型 (LLM)** | 需要语言组织能力和逻辑推理。 |

---

## 3. Agent 系统中的落地 (Agent Implementation)

| 环节 | 谁来做？ | 为什么？ |
| :--- | :--- | :--- |
| **感知 (Perception)** | **代码 (Sensors/API)** | 获取环境数据是机械操作。 |
| **记忆检索 (Memory)** | **算法 (Vector DB)** | 从历史记录中找相似经验，算法最快。 |
| **决策 (Decision)** | **大模型 (LLM)** | "根据现状和经验，下一步该干嘛？" 这是核心思考。 |
| **行动 (Action)** | **代码 (Tools)** | 执行具体的命令（如发邮件、查库）必须精确无误。 |

---

## 4. 警示录 (Anti-Patterns)

*   ❌ **反模式 1**：把 100 篇文档直接扔给 LLM 让它选。（浪费 Token，甚至导致模型注意力分散）
    *   ✅ **修正**：先用算法选出 Top 5，再给 LLM。
*   ❌ **反模式 2**：让 LLM 去做 keyword 匹配。（大炮打蚊子，且容易出错）
    *   ✅ **修正**：用正则或 ElasticSearch 做匹配。
*   ❌ **反模式 3**：让 LLM 记住所有历史对话。（Context 爆炸）
    *   ✅ **修正**：用总结算法压缩历史，或用向量库存储长期记忆。

---

> **总结**：
> 一个优秀的 AI 系统，应该像一个**精密的机械钟表 (算法)**，中间镶嵌着一颗**智慧的宝石 (LLM)**。
> 机械负责精准运转，宝石负责赋予灵魂。
