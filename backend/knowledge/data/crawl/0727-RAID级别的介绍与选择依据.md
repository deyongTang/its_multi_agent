# 知识库 727

## 标题
RAID级别的介绍与选择依据

## 问题描述
针对RAID 0+1/10、RAID 3以及RAID 5的工作原理和特性，作一些分析和比较，以列出这些不同RAID阶层所适合的应用，对使用者能有原则性的帮助。

## 分类
主类别: 内置设备
子类别: 硬盘

## 关键词
RAID, 磁盘阵列, RAID5, 存储

## 元信息
创建时间:2024-12-15|版本:1.0

## 解决方案
RAID 在市场上的的应用，已经不是新鲜的事儿了，很多人都大略了解RAID的基本观念，以及各个不RAID LEVEL 的区分。但是在实际应用面，我们发现，有很多使用者对于选择一个合适的RAID LEVEL，仍然无法很确切的掌握，尤其是对于RAID 0+1 （10），RAID 3，RAID 5之间的选择取舍，更是举棋不定。

　　下面将针对RAID 0+1/10、RAID 3以及RAID 5的工作原理和特性，作一些分析和比较，以列出这些不同RAID阶层所适合的应用，对使用者能有原则性的帮助。

 

　　 **RAID条带“striped”的存取模式**

　　在使用数据条带（Data Stripping）的RAID 系统之中，对成员磁盘驱动器的存取方式，可分为两种：

　　并行存取Paralleled Access。

　　独立存取dependent Access。

　　RAID 2和RAID 3 是采取并行存取模式。

RAID 0、RAID 4、RAID 5及RAID 6则是采用独立存取模式。

 

　　 **平行存取模式**

　　并行存取模式支持里，是把所有磁盘驱动器的主轴马达作精密的控制，使每个磁盘的位置都彼此同步，然后对每一个磁盘驱动器作一个很短的I/O数据传送，如此一来，从主机来的每一个I/O 指令，都平均分布到每一个磁盘驱动器。

　　为了达到并行存取的功能，RAID 中的每一个磁盘驱动器，都必须具备几乎完全相同的规格：转速必须一样；磁头搜寻速度Access Time必须相同；Buffer 或Cache的容量和存取速度要一致；CPU处理指令的速度要相同；I/O Channel 的速度也要一样。总而言之，要利用并行存取模式，RAID 中所有的成员磁盘驱动器，应该使用同一厂牌，相同型号的磁盘驱动器。

 

　 **并行存取的基本工作原理**

假设RAID中共有四部相同规格的磁盘驱动器，分别为磁盘驱动器A、B、C和D，我们在把时间轴略分为T0、T1、T2、T3和T4：

T0： RAID控制器将第一笔数据传送到A的Buffer，磁盘驱动器B、C和D的Buffer都是空的，在等待中； 

      T1： RAID控制器将第二笔数据传送到B的Buffer，A开始把Buffer中的数据写入扇区，磁盘驱动器C和D的Buffer都是空的，在等待中； 

      T2： RAID控制器将第三笔数据传送到C的Buffer，B开始把Buffer中的数据写入扇区，A已经完成写入动作，磁盘驱动器D和A的Buffer都是空的，在等待中；

      T3： RAID控制器将第四笔数据传送到D的Buffer，C开始把Buffer中的数据写入扇区，B已经完成写入动作，磁盘驱动器A和B的Buffer都是空的，在等待中；

      T4： RAID控制器将第五笔数据传送到A的Buffer，D开始把Buffer中的数据写入扇区，C已经完成写入动作，磁盘驱动器B和C的Buffer都是空的，在等待中；

    如此一直循环，一直到把从主机来的这个I/O 指令处理完毕，RAID控制器才会受处理下一个I/O 指令。重点是在任何一个磁盘驱动器准备好把数据写入扇区时，该目的扇区必须刚刚好转到磁头下。同时RAID控制器每依次传给一个磁盘驱动器的数据长度，也必须刚刚好，配合磁盘驱动器的转速，否则一旦发生miss，RAID 性能就大打折扣。

 

　　**并行存取RAID的最佳应用**

并行存取RAID之架构，以其精细的马达控制和分布之数据传输，将数组中每一个磁盘驱动器的性能发挥到最大，同时充分利用Storage Bus的频宽，因此特别适合应用在大型、数据连续的档案存取应用，例如：

　　影像、视讯档案服务器；

　　数据仓储系统；

　　多媒体数据库；

　　电子图书馆；

　　印前或底片输出档案服务器；

　　其它大型且连续性档案服务器；

　由于并行存取RAID架构之特性，RAID 控制器一次只能处理一个I/O要求，无法执行Overlapping 的多任务，因此非常不适合应用在I/O次数频繁、数据随机存取、每笔数据传输量小的环境。同时，因为并行存取无法执行Overlapping 的多任务，因此没有办法"隐藏"磁盘驱动器搜寻?zseek?{的时间，而且在每一个I/O的第一笔数据传输，都要等待第一个磁盘驱动器旋转延迟?zrotational latency?{，平均为旋转半圈的时间，如果使用一万转的磁盘驱动器，平均就需要等待50 usec。所以机械延迟时间，是并行存取架构的最大问题。

 

　　 **独立存取模式**

　　相对于并行存取模式，独立存取模式并不对成员磁盘驱动器作同步转动控制，其对每个磁盘驱动器的存取，都是独立且没有顺序和时间间格的限制，同时每笔传输的数据量都比较大。因此，独立存取模式可以尽量地利用overlapping 多任务、Tagged Command Queuing等等高阶功能，来"隐藏"上述磁盘驱动器的机械时间延迟Seek 和Rotational Latency。

　　由于独立存取模式可以做overlapping 多任务，而且可以同时处理来自多个主机不同的I/O Requests，在多主机环境如Clustering，更可发挥最大的性能。

　　独立存取RAID的最佳应用

　　由于独立存取模式可以同时接受多个I/O Requests，因此特别适合应用在数据存取频繁、每笔数据量较小的系统。例如：

　　在线交易系统或电子商务应用；

　　多使用者数据库；

　　ERM及MRP 系统；

　　小文件之文件服务器；

一般常用的RAID阶层，分别是RAID 0、RAID1、RAID 3、RAID 4以及RAID 5，再加上二合一型 RAID 0+1或称RAID 10。我们先把这些RAID级别的优、缺点做个比较：

 

**RAID级别** **相对优点** **相对缺点**

        RAID 0 存取速度最快 没有容错 ;

        RAID 1 完全容错 成本高 ;

        RAID 3 写入性能最好 没有多任务功能；

        RAID 4 具备多任务及容错功能 Parity 磁盘驱动器造成性能瓶颈；

        RAID 5 具备多任务及容错功能 写入时有overhead；

        RAID 0+1/RAID 10 速度快、完全容错 、成本高；

接下来，我们分别针对RAID 3、RAID 5以及RAID 0+1/RAID 10作深入的讨论。

 

　　**RAID 3特点与应用**

　　RAID 3 是将数据先做XOR 运算，产生Parity Data后，在将数据和Parity Data以并行存取模式写入成员磁盘驱动器中，因此具备并行存取模式的优点和缺点。进一步来说，RAID 3每一笔数据传输，都更新整个Stripe即每一个成员磁盘驱动器相对位置的数据都一起更新，因此不会发生需要把部分磁盘驱动器现有的数据读出来，与新数据作XOR运算，再写入的情况发生这个情况在RAID 4和RAID 5会发生，一般称之为Read、Modify、Write Process，我们姑且译为为读、改、写过程。因此，在所有RAID级别中，RAID 3的写入性能是最好的。

　　RAID 3的 Parity Data 一般都是存放在一个专属的Parity Disk，但是由于每笔数据都更新整个Stripe，因此，RAID 3的 Parity Disk 并不会如RAID 4的 Parity Disk，会造成存取的瓶颈。

　　RAID 3的并行存取模式，需要RAID 控制器特别功能的支持，才能达到磁盘驱动器同步控制，而且上述写入性能的优点，以目前的Caching 技术，都可以将之取代，因此一般认为RAID 3的应用，将逐渐淡出市场。

　　RAID 3 以其优越的写入性能，特别适合用在大型、连续性档案写入为主的应用，例如绘图、影像、视讯编辑、多媒体、数据仓储、高速数据撷取等等。

 

**RAID 4特点与应用**

　　RAID 4 是采取独立存取模式，同时以单一专属的Parity Disk 来存放Parity Data。RAID 4的每一笔传输Strip资料较长，而且可以执行Overlapped I/O，因此其读取的性能很好。

　　但是由于使用单一专属的Parity Disk 来存放Parity Data，因此在写入时，就会造成很大的瓶颈。因此，RAID 4并没有被广泛地应用。

　　**RAID 5特点与应用**

　　RAID 5也是采取独立存取模式，但是其Parity Data 则是分散写入到各个成员磁盘驱动器，因此，除了具备Overlapped I/O 多任务性能之外，同时也脱离如RAID 4单一专属Parity Disk的写入瓶颈。但是，RAID 5在做资料写入时，仍然稍微受到"读、改、写过程"的拖累。

　　由于RAID 5 可以执行Overlapped I/O 多任务，因此当RAID 5的成员磁盘驱动器数目越多，其性能也就越高，因为一个磁盘驱动器再一个时间只能执行一个 Thread，所以磁盘驱动器越多，可以Overlapped 的Thread 就越多，当然性能就越高。但是反过来说，磁盘驱动器越多，数组中可能有磁盘驱动器故障的机率就越高，整个数组的可靠度，或MTDL （Mean Time to Data Loss） 就会降低。

　　由于RAID 5将Parity Data 分散存在各个磁盘驱动器，因此很符合XOR技术的特性。例如，当同时有好几个写入要求发生时，这些要写入的数据以及Parity Data 可能都分散在不同的成员磁盘驱动器，因此RAID 控制器可以充分利用Overlapped I/O，同时让好几个磁盘驱动器分别作存取工作，如此，数组的整体性能就会提高很多。

　　基本上来说，多人多任务的环境，存取频繁，数据量不是很大的应用，都适合选用RAID 5 架构，例如企业档案服务器、WEB 服务器、在线交易系统、电子商务等应用，都是数据量小，存取频繁的应用。

 

　　**RAID 0+1 RAID 10**

RAID 0+1/RAID 10，综合了RAID 0 和 RAID 1的优点，适合用在速度需求高，又要完全容错。RAID 0和RAID 1的原理很简单，合起来之后还是很简单，我们不打算详细介绍，倒是要谈谈，RAID 0+1到底应该是RAID 0 over RAID 1，还是RAID 1 over RAID 0，也就是说，是把多个RAID 1 做成RAID 0，还是把多个RAID 0 做成RAID 1？

 

**RAID 0 over RAID 1**

　　假设我们有四台磁盘驱动器，每两台磁盘驱动器先做成RAID 1，再把两个RAID 1做成RAID 0，这就是RAID 0 over RAID 1：

　　（RAID 1） A = Drive A1 + Drive A2 （Mirrored）

　　（RAID 1） B = Drive B1 + Drive B2 （Mirrored）

　　 RAID 0 = （RAID 1） A + （RAID 1） B （Striped）

　　 **RAID 1 over RAID 0**

　　假设我们有六台磁盘驱动器，每两台磁盘驱动器先做成RAID 0，再把两个RAID 0做成RAID 1，这就是RAID 0 over RAID 1：

　　（RAID 0） A = Drive A1 + Drive A2 （Striped）

　　（RAID 0） B = Drive B1 + Drive B2 （Striped）

　　 RAID 1 = （RAID 1） A + （RAID 1） B （Mirrored）

　　在这种架构之下，如果 （RAID 0） A有一台磁盘驱动器故障，（RAID 0） A就算毁了，当然RAID 1仍然可以正常工作；如果这时 （RAID 0） B也有一台磁盘驱动器故障，（RAID 0） B也就算毁了，此时RAID 1的两磁盘驱动器都算故障，整个RAID 1资料就毁了。

　　因此，RAID 0 OVER RAID 1应该比RAID 1 OVER RAID 0具备比较高的可靠度。所以我们建议，当采用RAID 0+1/RAID 10架构时，要先作RAID 1，再把数个RAID 1做成RAID 0。

<!-- 文档主题：RAID级别的介绍与选择依据 (知识库库编号: 727) -->